@model VetClinicCapstone.Models.ViewModel.JoinPatientOwnerViewModel


<!-- Modal to show consultation details -->
<div class="modal fade bs-example-modal-lg" id="ShowDetail-@Model.PatientTbls.Patient_ID" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="myLargeModalLabel">Consultation Details</h4>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-lg-4">
                        @{
                            var getFileName = Model.PatientTbls.FileName; // Access FileName from the current item
                            var getSpecies =  Model.PatientTbls.Species;
                        }
                        @if (!string.IsNullOrEmpty(getFileName))
                        {
                            <img src="@Url.Content("~/PetImage/" + getFileName)" alt="Image" style="height: 250px; width: 250px;" />
                        }
                        else
                        {
                            <img src="~/images/product/product-1.png" alt="Image" style="height: 250px; width: 250px;">
       
                        }
                        <h4>@Model.PatientTbls.PatientName</h4>
                    </div>
                    <div class="col-lg-8">
                        @if (Model.ConsultationWithDoctorViewModels.Any())
                {
                    @foreach (var item in Model.ConsultationWithDoctorViewModels)
                    {
                        <div class="border p-3 rounded mb-3 shadow-sm">
                            <h5 class="mb-2 text-primary">Consultation ID: C-@item.ConsultationTbls.Consultation_ID</h5>
                            <p class="mb-1"><strong>Services:</strong> @item.ServiceTbls.ServiceName</p>
                            <p class="mb-1"><strong>Diagnosis:</strong> @item.ConsultationTbls.Diagnosis</p>
                            <p class="mb-1"><strong>Consulted By:</strong> @item.DoctorTbls.Firstname</p>
                            <p class="mb-1"><strong>Date:</strong> @item.ConsultationTbls.ConsultationDate.ToString("MMMM d, yyyy h:mm tt")</p>
                            <button type="button" class="btn btn-primary btn-sm" data-toggle="modal" data-target="#MedicalInfo-@item.ConsultationTbls.Consultation_ID">
                                <i class="mdi mdi-eye"></i> View More
                            </button>
                        </div>
                    }
                }
                else
                {
                    <p class="text-center text-muted">No record available.</p>
                }
                    </div>
                </div>
                
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>

<!-- Modal to show medical information -->
@foreach (var item in Model.ConsultationWithDoctorViewModels)
{
    <div class="modal fade" id="MedicalInfo-@item.ConsultationTbls.Consultation_ID" tabindex="-1" role="dialog" aria-labelledby="medicalInfoLabel-@item.ConsultationTbls.Consultation_ID" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title" id="medicalInfoLabel-@item.ConsultationTbls.Consultation_ID">Medical Information for C-@item.ConsultationTbls.Consultation_ID</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <!-- Add detailed medical information here -->

                        <div class="nav-tabs-custom">
                            <ul class="nav nav-tabs">
                                <li><a href="#usertimeline-@item.ConsultationTbls.Consultation_ID" data-toggle="tab" class="active">Vital</a></li>
                                <li><a href="#settings-@item.ConsultationTbls.Consultation_ID" data-toggle="tab" class="">Treatment</a></li>
                                <li><a href="#laboratory-@item.ConsultationTbls.Consultation_ID" data-toggle="tab" class="">Laboratory</a></li>
                            </ul>

                            <div class="tab-content">
                                <div class="tab-pane active" id="usertimeline-@item.ConsultationTbls.Consultation_ID">
                                    <!-- Vital content here -->
                                    <div class="col-xl-12 col-12">
                                        <div class="box">
                                            <div class="box-header">
                                                <h4 class="box-title">Vitals</h4>
                                            </div>
                                            <div class="box-body">
                                                <div class="flexbox bb-1 mb-15">
                                                    <div><p><span class="text-mute">Pet Name:</span> <strong>@Model.PatientTbls.PatientName</strong></p></div>
                                                    <div><p><span class="text-mute">Patient ID:</span> <strong>@Model.PatientTbls.Patient_ID</strong></p></div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-12">
                                                        <div class="row bb-1 pb-10">
                                                            <div class="col-3">
                                                                <img class="img-fluid float-left w-30 mt-10 mr-10" src="~/images/weight.png" alt="">
                                                                <div>
                                                                    <p class="mb-0"><small>Weight</small></p>
                                                                    <h5 class="mb-0"><strong>@item.ConsultationTbls.Weight KG</strong></h5>
                                                                </div>
                                                            </div>
                                                            <div class="col-3 bl-1 br-1">
                                                                <img class="img-fluid float-left w-40 mt-8 mr-8" src="~/images/temperature.png" alt="">
                                                                <div>
                                                                    <p class="mb-0"><small>Temperature</small></p>
                                                                    <h5 class=" mb-0"><strong>@item.ConsultationTbls.Temparature</strong></h5>
                                                                </div>
                                                            </div>
                                                            <div class="col-3 bl-1 br-1">
                                                                <img class="img-fluid float-left w-30 mt-10 mr-10" src="~/images/bmi.png" alt="">
                                                                <div>
                                                                    <p class="mb-0"><small>Heart Rate </small></p>
                                                                    <h5 class="mb-0"><strong>@item.ConsultationTbls.HeartRate</strong></h5>
                                                                </div>
                                                            </div>
                                                            <div class="col-3">
                                                                <img class="img-fluid float-left w-60 mt-5 mr-5" src="~/images/respiratory.png" alt="">
                                                                <div>
                                                                    <p class="mb-0"><small>Respiratory Rate</small></p>
                                                                    <h5 class="mb-0"><strong>@item.ConsultationTbls.RepiratoryRate</strong></h5>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="row pt-5">
                                                            <div class="col-6  bb-1">
                                                                <div class="col-12">
                                                                    <span class="text-danger">Clinical Sign</span>
                                                                </div>
                                                                <div class="col-6">
                                                                    <div class="progress progress-xs mb-0 mt-5 w-40">
                                                                        <div class="progress-bar progress-bar-success progress-bar-striped" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: 100%">
                                                                        </div>
                                                                    </div>
                                                                    <h2 class="float-left mt-0 mr-10"><strong>@item.ConsultationTbls.ClinicalSign</strong></h2>
                                                                </div>
                                                            </div>
                                                        <div class="col-6 bl-1 bb-1">
                                                            <div class="col-12">
                                                                <span class="text-danger">Diagnosis</span>
                                                            </div>
                                                            <div class="col-6">
                                                                <div class="progress progress-xs mb-0 mt-5 w-40">
                                                                    <div class="progress-bar progress-bar-success progress-bar-striped" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: 100%">
                                                                    </div>
                                                                </div>
                                                                <h2 id="diagnosis-heading-@item.ConsultationTbls.Consultation_ID" class="float-left mt-0 mr-10">
                                                                    <strong>@item.ConsultationTbls.Diagnosis</strong>
                                                                </h2>
                                                                <!-- Add Diagnosis Icon -->
<a href="#" data-consultation-id="@item.ConsultationTbls.Consultation_ID" class="float-right mt-2" data-toggle="modal" data-target="#addDiagnosisModal-@item.ConsultationTbls.Consultation_ID">
    <i class="mdi mdi-plus text-primary" style="font-size: 1.5rem;"></i>
</a>
                                                            </div>
                                                        </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="box-body pt-0">
                                                <p><small>Recorded on @item.ConsultationTbls.ConsultationDate.ToString("MMMM dd, yyyy")</small></p>
                                            </div>
                                            
                                        </div>
                                    </div>
                                    <!-- Add more details as needed -->
                                </div>
                                <!-- /.tab-pane -->


                                <!-- /.tab-pane -->

<!--------------------------------------------------------------------------------------------------------------------------------------------------------------------->


                            <div class="tab-pane" id="settings-@item.ConsultationTbls.Consultation_ID">
                                @if (Model.TreatmentTbls.Any(p => p.Consultation_ID == item.ConsultationTbls.Consultation_ID))
                                    {
                                    <div class="text-right mb-10">
                                        @if(User.IsInRole("Doctor"))
                                        {
                                        <button data-toggle="modal" data-target="#treatmentForm-@item.ConsultationTbls.Consultation_ID" data-consultation-id="@item.ConsultationTbls.Consultation_ID" class="btn btn-rounded btn-success text-dark">
                                            <i class="mdi mdi-plus"></i> Treament
                                        </button>
                                         }
                                    </div>
                                    <div class="treatment-container">
                                        @foreach (var treatment in Model.TreatmentTbls.Where(p => p.Consultation_ID == item.ConsultationTbls.Consultation_ID))
                                    {
                                       
                                        <div class="col-lg-12 mb-4">
                                            <div class="card border-primary position-relative">
                                                <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                                                    <span>Treatment Details</span>
                                                    <div class="d-flex justify-content-between align-items-center mb-3">
                                                        <h4 class="text-primary">Treament</h4>
     
                                                    </div>
                                                </div>
                                                <div class="card-body">
                                                    <div class="mb-3">
                                                        <h5 class="card-title">Treatment Name</h5>
                                                        <p class="card-text text-muted">@treatment.TreatmentType</p>
                                                    </div>
                                                    <div class="mb-3">
                                                        <h5 class="card-title">Notes</h5>
                                                        <p class="card-text text-muted">@treatment.Notes</p>
                                                    </div>
                                                    <div class="mb-3">

                                                        @if(treatment.FollowUpCheckUp !=null)
                                                        {
                                                            <h5 class="card-title">Follow-up Check</h5>
                                                            <p class="card-text text-muted">@treatment.FollowUpCheckUp?.ToString("MMMM dd, yyyy")</p>
                                                        }
                                                        else
                                                        {
                                                            <h5 class="card-title">Remarks</h5>
                                                            <p class="card-text text-muted">Ok</p>
                                                        }


                                                    </div>
                                                </div>
                                                <div class="card-footer text-end">
                                                    @if(User.IsInRole("Doctor"))
                                                    {
                                                    <button type="button" class="btn btn-primary btn-rounded"
                                                            data-toggle="modal"
                                                            data-target="#ViewPrescription-@item.ConsultationTbls.Consultation_ID"
                                                            data-treatment-id="@treatment.Treatment_ID"
                                                            onclick="setTreatmentId(this)">
                                                        <i class="mdi mdi-eye"></i> Prescription
                                                    </button>
                                                     }
                                                </div>
                                            </div>
                                        </div>
                                       


                                        <script>
                                            function setTreatmentId(button) {
                                                // Get the value from the button's data attribute
                                                var treatmentId = $(button).data('treatment-id');

                                                // Find the related input field by its ID
                                                var inputId = 'treatment-' + $(button).attr('data-target').split('-')[1];

                                                // Set the value in the input field
                                                $('#' + inputId).val(treatmentId);
                                            }
                                        </script>



                                        <!--------------------------------------------------------------------------------------------------------------------------------------------------------------------->
                                        <!--PRESCRIPTION MODAL--->
                                        <div class="modal fade" id="ViewPrescription-@item.ConsultationTbls.Consultation_ID" tabindex="-1" role="dialog" aria-labelledby="modalLabel-@item.ConsultationTbls.Consultation_ID" aria-hidden="true">
                                            <div class="modal-dialog modal-xl">
                                                <div class="modal-content">
                                                    <div class="modal-header">
                                                        <h4 class="modal-title" id="modalLabel-@item.ConsultationTbls.Consultation_ID">Prescription Details</h4>
                                                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                                                    </div>
                                                    <div class="modal-body">

                                                        @if (Model.PrescriptionWithDoctorViewModels.Any(p => p.PrescriptionTbls.Consultation_ID == item.ConsultationTbls.Consultation_ID))
                                                        {
                                                            @foreach (var prescription in Model.PrescriptionWithDoctorViewModels.Where(p => p.PrescriptionTbls.Prescription_ID == treatment.Prescription_ID))
                                                            {
                                                                <div class="border p-3 rounded mb-3 shadow-sm d-flex justify-content-between align-items-center">
                                                                    <div>
                                                                        <h5 class="mb-2 text-primary">Prescription ID: P-@prescription.PrescriptionTbls.Prescription_ID</h5>
                                                                        <p class="mb-1"><strong>Date Prescribed:</strong> @prescription.PrescriptionTbls.DatePrescribed?.ToString("MMMM d, yyyy")</p>
                                                                        <p class="mb-1"><strong>Doctor:</strong> @prescription.AdminInfoTbls.Firstname @prescription.AdminInfoTbls.Lastname</p>
                                                                    </div>
                                                                    <a href="@Url.Action("PrescriptionDetails", "Patient", new { id = prescription.PrescriptionTbls.Prescription_ID })" class="btn btn-primary btn-sm">
                                                                        <i class="mdi mdi-eye"></i> View
                                                                    </a>
                                                                </div>
                                                            }
                                                        }
                                                        else
                                                        {
                                                            <div class="d-flex justify-content-between align-items-center mb-3">
                                                                <h4 class="text-primary">Prescriptions</h4>
                                                                <button data-toggle="modal" data-target="#AddPrescription-@item.ConsultationTbls.Consultation_ID" class="btn btn-rounded btn-success text-dark">
                                                                    <i class="mdi mdi-plus"></i> New Prescription
                                                                </button>
                                                            </div>
                                                            <p class="text-center text-muted">No prescriptions available.</p>
                                                        }
                                                    </div>
                                                    <div class="modal-footer">
                                                        <button data-dismiss="modal" type="button" class="btn btn-rounded btn-danger btn-outline mr-1">
                                                            <i class="mdi mdi-close"></i> Close
                                                        </button>
                                                    </div>
                                                </div>
                                                <!-- /.modal-content -->
                                            </div>
                                            <!-- /.modal-dialog -->
                                        </div>
                                        <!-- /.modal -->
                                        
                                    }
                                    </div>

                                }
                                else
                                {
                                    <div class="d-flex justify-content-between align-items-center mb-3">
                                        <h4 class="text-primary">Treament</h4>

                                        @if (User.IsInRole("Doctor"))
                                        {
                                            <button data-toggle="modal" data-target="#treatmentForm-@item.ConsultationTbls.Consultation_ID" data-consultation-id="@item.ConsultationTbls.Consultation_ID" class="btn btn-rounded btn-success text-dark">
                                                <i class="mdi mdi-plus"></i> Treament
                                            </button>
                                        }

                                    </div>
                                    <div class="treatment-container">

                                        <p id="noTreatmentRecord" class="text-center text-muted">No treatment available.</p>
                                    </div>
                                    }

                                


                            </div>
                                <div class="tab-pane" id="laboratory-@item.ConsultationTbls.Consultation_ID">

                                @if (Model.LaboratoryTbls.Any(p => p.Consultation_ID == item.ConsultationTbls.Consultation_ID))
                                {
                                    @foreach (var laboratory in Model.LaboratoryTbls.Where(p => p.Consultation_ID == item.ConsultationTbls.Consultation_ID))
                                    {
                                        <div class="border p-3 rounded mb-3 shadow-sm">
                                            <p class="mb-1 d-flex justify-content-between align-items-center">
                                                <strong>Laboratory test: </strong>@laboratory.LaboratoryName
                                                <span>
                                                    @if(laboratory.LabFileName !=null)
                                                    {
                                                        <button class="btn btn-primary btn-sm ml-2" data-toggle="modal" data-target="#imageModal-@item.ConsultationTbls.Consultation_ID" data-filename-id="@laboratory.LabFileName">
                                                            <i class="mdi mdi-eye"></i> View
                                                        </button>
                                                    }
                                                    else
                                                    {
                                                        <button class="btn btn-warning btn-sm ml-2 uploadLabresult" data-lab-id="@laboratory.Laboratory_ID">
                                                            <i class="mdi mdi-upload"></i> Upload
                                                        </button>
                                                    }
                                                </span>
                                            </p>
                                        </div>
                                    }
                                }
                                else
                                {
                                    <p class="text-center text-muted">No laboratory available.</p>
                                }
                                </div>
                                <!-- /.tab-pane -->
                            </div>
                            <!-- /.tab-content -->
                        </div>
                </div>
            </div>
            <!-- /.modal-content -->
        </div>
        <!-- /.modal-dialog -->
    </div>
    <script>
        $(document).ready(function () {
            $('.uploadLabresult').on('click', function () {
                var laboratoryID = $(this).data('lab-id');
                debugger
                $('#labID-@item.ConsultationTbls.Consultation_ID').val(laboratoryID);


                $('#uploadLabresultModal-@item.ConsultationTbls.Consultation_ID').modal('show');
            });
        });
    </script>


    <!--------------IMAGE LAB MODAL SHOW----------->
    <div class="modal fade" id="imageModal-@item.ConsultationTbls.Consultation_ID" tabindex="-1" role="dialog" aria-labelledby="imageModalLabel-@item.ConsultationTbls.Consultation_ID" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="imageModalLabel-@item.ConsultationTbls.Consultation_ID">Laboratory Result</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body text-center">
                    <!-- Image inside modal with dynamic src -->
                    <img id="modalImage-@item.ConsultationTbls.Consultation_ID" src="~/labotatoryresultimage/" class="img-fluid" alt="Responsive image">
                </div>
            </div>
        </div>
    </div>



    <script>
        // When the modal is triggered, change the src of the image
        $('button[data-toggle="modal"]').on('click', function () {
            // Get the image file name from the button's data attribute
            var filename = $(this).data('filename-id');

            // Get the Consultation_ID from the button's data-target (extracted from the ID)
            var targetModal = $(this).data('target');

            // Update the src of the image inside the modal
            $(targetModal).find('img').attr('src', '/labotatoryresultimage/' + filename);
        });
    </script>
   


  
    <!----------Add Prescription Modal--------->


    <div class="modal fade" id="AddPrescription-@item.ConsultationTbls.Consultation_ID" tabindex="-1" role="dialog" aria-labelledby="medicalInfoLabel-@item.ConsultationTbls.Consultation_ID" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title" id="myLargeModalLabel">Prescription</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                </div>
                <div class="modal-body">
                    <div class="container mt-5">
                        <h2 class="text-center">Prescription Form</h2>
                        <div class="alert alert-danger" id="validationPrescription-@item.ConsultationTbls.Consultation_ID" style="display:none;">
                            Please add at least one prescription before saving.
                        </div>
                        <form id="prescriptionForm-@item.ConsultationTbls.Consultation_ID" class="prescription-form needs-validation" novalidate>
                            <input type="hidden" id="patientid-@item.ConsultationTbls.Consultation_ID" value="@item.ConsultationTbls.Patient_ID" name="Patient_ID" placeholder="Patient ID" readonly>
                            <input type="hidden" id="treatment-@item.ConsultationTbls.Consultation_ID" name="Treatment_ID" placeholder="Treatment ID" readonly>

                            <div class="row">
                                <div class="form-group col-lg-6">
                                    <label for="medicine-@item.ConsultationTbls.Consultation_ID">Medicine</label>
                                    <input type="text" class="form-control" id="medicine-@item.ConsultationTbls.Consultation_ID" placeholder="Medicine" required>
                                    <div class="invalid-feedback">Please enter a Medicine.</div>
                                </div>
                                <div class="form-group col-lg-6">
                                    <label for="dosage-@item.ConsultationTbls.Consultation_ID">Dosage</label>
                                    <input type="text" class="form-control" id="dosage-@item.ConsultationTbls.Consultation_ID" placeholder="Dosage">
                                </div>
                            </div>
                            <div class="row">
                                <div class="form-group col-lg-6">
                                    <label for="frequency-@item.ConsultationTbls.Consultation_ID">Frequency</label>
                                    <input type="text" class="form-control" id="frequency-@item.ConsultationTbls.Consultation_ID" placeholder="Frequency" required>
                                    <div class="invalid-feedback">Please enter a frequency.</div>
                                </div>
                                <div class="form-group col-lg-6">
                                    <label for="instructions-@item.ConsultationTbls.Consultation_ID">Instructions</label>
                                    <input type="text" class="form-control" id="instructions-@item.ConsultationTbls.Consultation_ID" placeholder="Instructions" required>
                                    <div class="invalid-feedback">Please enter instructions.</div>
                                </div>
                            </div>
                            <button type="button" class="btn btn-primary" onclick="addPrescription('@item.ConsultationTbls.Consultation_ID')">Add Prescription</button>
                        </form>

                        <h3 class="text-center mt-4">Prescriptions</h3>
                        <div class="table-responsive">
                            <table class="table table-bordered mt-3">
                                <thead>
                                    <tr>
                                        <th>#</th>
                                        <th>Medicine</th>
                                        <th>Dosage</th>
                                        <th>Frequency</th>
                                        <th>Instructions</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="prescriptionsList-@item.ConsultationTbls.Consultation_ID"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="modal-footer text-right">
                    <button data-dismiss="modal" type="button" class="btn btn-rounded btn-danger btn-outline mr-1">
                        <i class="mdi mdi-close"></i> Close
                    </button>
                    <button id="SavePrescription-@item.ConsultationTbls.Consultation_ID" onclick="confirmSavePrescriptions('@item.ConsultationTbls.Consultation_ID')" type="button" class="text-right btn btn-rounded btn-primary btn-outline">
                        <i class="ti-save-alt"></i> Save
                    </button>
                </div>
            </div>
        </div>
    </div>



    <div class="modal fade" id="uploadLabresultModal-@item.ConsultationTbls.Consultation_ID" tabindex="-1" role="dialog" aria-labelledby="medicalInfoLabel-@item.ConsultationTbls.Consultation_ID" aria-hidden="true">
        <div class="modal-dialog modal-md">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title" id="myLargeModalLabel">Upload</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                </div>
                  <div class="modal-body">

                     <form id="uploadLab-@item.ConsultationTbls.Consultation_ID" class="needs-validation"novalidate>
                    <div class="form-row align-items-center">
                        <!-- Laboratory ID Input -->
                        <div class="form-group col-md-6">
                            <label  class="form-label">Laboratory ID</label>
                            <input class="form-control" name="Laboratory_ID" id="labID-@item.ConsultationTbls.Consultation_ID" type="text" placeholder="Enter Laboratory ID" readonly/>

                        </div>

                        <!-- File Upload Input -->
                        <div class="form-group col-md-6">
                            <label class="form-label">Upload Lab Result</label>
                            <input class="form-control" name="labResultUpload" type="file" required accept=".jpeg, .png" />
                            <div class="invalid-feedback">Please upload a valid file (.jpeg or .png).</div>
                        </div>
                    </div>
                    </form>
                  </div>
                <div class="modal-footer text-right">
                    <button data-dismiss="modal" type="button" class="btn btn-rounded btn-danger btn-outline mr-1">
                        <i class="mdi mdi-close"></i> Close
                    </button>
                    <button id="UploadLabButton-@item.ConsultationTbls.Consultation_ID" type="button" class="text-right btn btn-rounded btn-primary btn-outline">
                        <i class="ti-save-alt"></i> Save
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        $(document).ready(function () {
            $('#UploadLabButton-@item.ConsultationTbls.Consultation_ID').click(function (event) {
                event.preventDefault(); // Prevent default form submission

                var form = $('#uploadLab-@item.ConsultationTbls.Consultation_ID')[0]; // Get the form element
                var formData = new FormData(form); // Create a FormData object

                // Check form validity
                if (!form.checkValidity()) {
                    form.classList.add('was-validated');
                    return;
                }

                // Show SweetAlert for confirmation
                Swal.fire({
                    title: 'Are you sure?',
                    text: "Do you want to save this record?",
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'Yes, save it!',
                    cancelButtonText: 'No, cancel'
                }).then((result) => {
                    if (result.isConfirmed) {
                        // Proceed with AJAX submission if the user clicks "Yes"
                        $.ajax({
                            url: "@Url.Action("LaboratoryUpload", "Patient")",
                            type: "POST",
                            data: formData,
                            contentType: false, // Tell jQuery not to set contentType
                            processData: false, // Tell jQuery not to process data
                            success: function (response) {
                                if (response.success) {
                                    // Show success message
                                    Swal.fire(
                                        'Saved!',
                                        response.message,
                                        'success'
                                    ).then(() => {
                                        // Redirect after success
                                       window.location.href = "@Url.Action("ViewRecord", "Patient")";
                                    });
                                } else {
                                    // Show error message
                                    Swal.fire('Error', response.message, 'error');
                                }
                            },
                            error: function (error) {
                                console.error("Error occurred during submission", error);
                                Swal.fire('Error', 'An error occurred during submission', 'error');
                            }
                        });
                    }
                });
            });
        });
    </script>
    
    @* <script>
        let prescriptions = {};

        function addPrescription(consultationId) {
            const form = document.getElementById(`prescriptionForm-${consultationId}`);
            if (!form.checkValidity()) {
                form.classList.add('was-validated');
                return;
            }

            const dosage = document.getElementById(`dosage-${consultationId}`).value;
            const frequency = document.getElementById(`frequency-${consultationId}`).value;
            const instructions = document.getElementById(`instructions-${consultationId}`).value;
            const medicine = document.getElementById(`medicine-${consultationId}`).value;

            if (!prescriptions[consultationId]) {
                prescriptions[consultationId] = [];
            }

            const prescription = {
                Dosage: dosage,
                Frequency: frequency,
                Instruction: instructions,
                Medicine: medicine
            };

            prescriptions[consultationId].push(prescription);
            renderPrescriptions(consultationId);
            clearForm(consultationId);
        }

        function renderPrescriptions(consultationId) {
            const prescriptionsList = document.getElementById(`prescriptionsList-${consultationId}`);
            if (!prescriptions[consultationId]) {
                prescriptionsList.innerHTML = '';
                return;
            }

            prescriptionsList.innerHTML = '';
            prescriptions[consultationId].forEach((prescription, index) => {
                prescriptionsList.innerHTML += `
                                <tr>
                                    <td>${index + 1}</td>
                                    <td>${prescription.Medicine}</td>
                                    <td>${prescription.Dosage}</td>
                                    <td>${prescription.Frequency}</td>
                                    <td>${prescription.Instruction}</td>
                                    <td><button type="button" class="btn btn-danger" onclick="removePrescription('${consultationId}', ${index})">Remove</button></td>
                                </tr>
                            `;
            });
        }

        function clearForm(consultationId) {
            document.getElementById(`medicine-${consultationId}`).value = '';
            document.getElementById(`dosage-${consultationId}`).value = '';
            document.getElementById(`frequency-${consultationId}`).value = '';
            document.getElementById(`instructions-${consultationId}`).value = '';
            const form = document.getElementById(`prescriptionForm-${consultationId}`);
            form.classList.remove('was-validated');
        }

        function removePrescription(consultationId, index) {
            if (prescriptions[consultationId]) {
                prescriptions[consultationId].splice(index, 1);
                renderPrescriptions(consultationId);
            }
        }

        function confirmSavePrescriptions(consultationId) {
            Swal.fire({
                title: 'Are you sure?',
                text: "Do you want to save these prescriptions?",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Yes, save it!'
            }).then((result) => {
                if (result.isConfirmed) {
                    savePrescriptions(consultationId);
                }
            });
        }

        function savePrescriptions(consultationId) {
            const url = "/SavePrescriptions";
            const patientId = document.getElementById(`patientid-${consultationId}`).value;
            const treatmentId = document.getElementById(`treatment-${consultationId}`).value;

            const requestBody = {
                Treatment_ID: treatmentId,
                Consultation_ID: consultationId,
                Patient_ID: patientId,
                Prescriptions: prescriptions[consultationId]
            };

            fetch(url, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(requestBody)
            }).then(response => response.json())
                .then(data => {
                    if (data.newId) {
                        Swal.fire({
                            title: 'Saved!',
                            text: 'Prescriptions have been saved.',
                            icon: 'success'
                        }).then(() => {
                           
                            // Perform the redirection with the new ID
                            window.location.href = `/Patient/PrescriptionDetails/${data.newId}`;
                        });
                    } else {
                        Swal.fire({
                            title: 'Error!',
                            text: 'There was a problem saving the prescriptions.',
                            icon: 'error'
                        });
                    }
                });
        }

        
    </script> *@




    <script>
        let prescriptions = {};

        function addPrescription(consultationId) {
            const form = document.getElementById(`prescriptionForm-${consultationId}`);
            if (!form.checkValidity()) {
                form.classList.add('was-validated');
                return;
            }

            const dosage = document.getElementById(`dosage-${consultationId}`).value;
            const frequency = document.getElementById(`frequency-${consultationId}`).value;
            const instructions = document.getElementById(`instructions-${consultationId}`).value;
            const medicine = document.getElementById(`medicine-${consultationId}`).value;

            if (!prescriptions[consultationId]) {
                prescriptions[consultationId] = [];
            }

            const prescription = {
                Dosage: dosage,
                Frequency: frequency,
                Instruction: instructions,
                Medicine: medicine
            };

            prescriptions[consultationId].push(prescription);
            renderPrescriptions(consultationId);
            clearForm(consultationId);
        }

        function renderPrescriptions(consultationId) {
            const prescriptionsList = document.getElementById(`prescriptionsList-${consultationId}`);
            if (!prescriptions[consultationId]) {
                prescriptionsList.innerHTML = '';
                return;
            }

            prescriptionsList.innerHTML = '';
            prescriptions[consultationId].forEach((prescription, index) => {
                prescriptionsList.innerHTML += `
                                        <tr>
                                            <td>${index + 1}</td>
                                            <td>${prescription.Medicine}</td>
                                            <td>${prescription.Dosage}</td>
                                            <td>${prescription.Frequency}</td>
                                            <td>${prescription.Instruction}</td>
                                            <td><button type="button" class="btn btn-danger" onclick="removePrescription('${consultationId}', ${index})">Remove</button></td>
                                        </tr>
                                    `;
            });
        }

        function clearForm(consultationId) {
            document.getElementById(`medicine-${consultationId}`).value = '';
            document.getElementById(`dosage-${consultationId}`).value = '';
            document.getElementById(`frequency-${consultationId}`).value = '';
            document.getElementById(`instructions-${consultationId}`).value = '';
            const form = document.getElementById(`prescriptionForm-${consultationId}`);
            form.classList.remove('was-validated');
        }

        function removePrescription(consultationId, index) {
            if (prescriptions[consultationId]) {
                prescriptions[consultationId].splice(index, 1);
                renderPrescriptions(consultationId);
            }
        }

        function confirmSavePrescriptions(consultationId) {
            const validationPrescription = document.getElementById("validationPrescription-@item.ConsultationTbls.Consultation_ID");

            // Check if the prescriptions list is empty
            if (!prescriptions[consultationId] || prescriptions[consultationId].length === 0) {
                // Show the validation message
                validationPrescription.style.display = "block";
                validationPrescription.textContent = "Please add at least one prescription before saving.";
                return; // Stop the function execution if no data
            }

            // Hide the validation message if there are prescriptions
            validationPrescription.style.display = "none";

            // Show confirmation if there is data
            Swal.fire({
                title: 'Are you sure?',
                text: "Do you want to save these prescriptions?",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Yes, save it!'
            }).then((result) => {
                if (result.isConfirmed) {
                    savePrescriptions(consultationId);
                }
            });
        }

        function savePrescriptions(consultationId) {
            const url = "/SavePrescriptions";
            const patientId = document.getElementById(`patientid-${consultationId}`).value;
            const treatmentId = document.getElementById(`treatment-${consultationId}`).value;

            const requestBody = {
                Treatment_ID: treatmentId,
                Consultation_ID: consultationId,
                Patient_ID: patientId,
                Prescriptions: prescriptions[consultationId]
            };

            fetch(url, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(requestBody)
            }).then(response => response.json())
                .then(data => {
                    if (data.newId) {
                        Swal.fire({
                            title: 'Saved!',
                            text: 'Prescriptions have been saved.',
                            icon: 'success'
                        }).then(() => {

                            // Perform the redirection with the new ID
                            window.location.href = `/Patient/PrescriptionDetails/${data.newId}`;
                        });
                    } else {
                        Swal.fire({
                            title: 'Error!',
                            text: 'There was a problem saving the prescriptions.',
                            icon: 'error'
                        });
                    }
                });
        }


    </script>
    @* <script>
        let prescriptions = {};

        function addPrescription(consultationId) {
            const form = document.getElementById(`prescriptionForm-${consultationId}`);
            if (!form.checkValidity()) {
                form.classList.add('was-validated');
                return;
            }

            const dosage = document.getElementById(`dosage-${consultationId}`).value;
            const frequency = document.getElementById(`frequency-${consultationId}`).value;
            const instruction = document.getElementById(`Instruction-${consultationId}`).value;
            const medicine = document.getElementById(`medicine-${consultationId}`).value;

            if (!prescriptions[consultationId]) {
                prescriptions[consultationId] = [];
            }

            const prescription = {
                Dosage: dosage,
                Frequency: frequency,
                Instruction: instruction,
                Medicine: medicine
            };

            prescriptions[consultationId].push(prescription);
            renderPrescriptions(consultationId);
            clearForm(consultationId);
        }

        function renderPrescriptions(consultationId) {
            const prescriptionsList = document.getElementById(`prescriptionsList-${consultationId}`);
            if (!prescriptions[consultationId]) {
                prescriptionsList.innerHTML = '';
                return;
            }

            prescriptionsList.innerHTML = '';
            prescriptions[consultationId].forEach((prescription, index) => {
                prescriptionsList.innerHTML += `
                    <tr>
                        <td>${index + 1}</td>
                        <td>${prescription.Medicine}</td>
                        <td>${prescription.Dosage}</td>
                        <td>${prescription.Frequency}</td>
                        <td>${prescription.Instruction}</td>
                        <td><button type="button" class="btn btn-danger" onclick="removePrescription('${consultationId}', ${index})">Remove</button></td>
                    </tr>
                `;
            });
        }

        function clearForm(consultationId) {
            document.getElementById(`medicine-${consultationId}`).value = '';
            document.getElementById(`dosage-${consultationId}`).value = '';
            document.getElementById(`frequency-${consultationId}`).value = '';
            document.getElementById(`Instruction-${consultationId}`).value = '';
            const form = document.getElementById(`prescriptionForm-${consultationId}`);
            form.classList.remove('was-validated');
        }

        function removePrescription(consultationId, index) {
            if (prescriptions[consultationId]) {
                prescriptions[consultationId].splice(index, 1);
                renderPrescriptions(consultationId);
            }
        }

        function confirmSavePrescriptions(consultationId) {
            Swal.fire({
                title: 'Are you sure?',
                text: "Do you want to save these prescriptions?",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Yes, save it!'
            }).then((result) => {
                if (result.isConfirmed) {
                    savePrescriptions(consultationId);
                }
            });
        }

        function savePrescriptions(consultationId) {
            const url = "/SavePrescriptions"; // Adjust the endpoint according to your server setup
            const patientId = document.getElementById(`patientid-${consultationId}`).value;

            const requestBody = {
                Consultation_ID: patientId,
                Prescriptions: prescriptions[consultationId] || []
            };

            console.log('Saving prescriptions:', requestBody); // Debugging line to check request body

            fetch(url, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(requestBody)
            }).then(response => {
                if (response.ok) {
                    Swal.fire(
                        'Saved!',
                        'Your prescriptions have been saved.',
                        'success'
                    ).then(() => {
                        window.location.reload();
                    });
                } else {
                    Swal.fire(
                        'Error!',
                        'There was an issue saving your prescriptions.',
                        'error'
                    );
                }
            }).catch(error => {
                console.error('Error:', error);
                Swal.fire(
                    'Error!',
                    'There was an issue saving your prescriptions.',
                    'error'
                );
            });
        }

        $(document).ready(function () {
            $(document).on('show.bs.modal', '.modal', function (event) {
                var button = $(event.relatedTarget); // Button that triggered the modal
                var patientId = button.data('patient-id'); // Extract info from data-* attributes
                var modal = $(this);
                modal.find(`#patientid-${patientId}`).val(patientId);
            });
        });
    </script> *@




    <!------Update Diagnosis Modal--------->
<div class="modal fade" id="addDiagnosisModal-@item.ConsultationTbls.Consultation_ID" tabindex="-1" role="dialog" aria-labelledby="addDiagnosisModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addDiagnosisModalLabel">Add Diagnosis</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="diagnosisForm-@item.ConsultationTbls.Consultation_ID">
                    <div class="form-group">
                        <label for="diagnosisText">Diagnosis</label>
                            <input type="text" class="form-control" id="diagnosisText-@item.ConsultationTbls.Consultation_ID" name="diagnosis" placeholder="Enter diagnosis">
                    </div>
                    <input type="hidden" class="form-control" id="diagnosis" name="Consultation_ID" placeholder="ID" readonly>
                    <!-- Add more input fields as needed -->
                </form>
            </div>
                <div class="modal-footer text-right">
                    <button data-dismiss="modal" type="button" class="btn btn-rounded btn-danger btn-outline mr-1">
                        <i class="mdi mdi-close"></i> Close
                    </button>
                    <button id="saveDiagnosis-@item.ConsultationTbls.Consultation_ID" type="button" class="text-right btn btn-rounded btn-primary btn-outline">
                        <i class="ti-save-alt"></i> Save
                    </button>
                </div>
        </div>
    </div>
</div>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            function toTitleCase(text) {
                return text.replace(/\w\S*/g, function (txt) {
                    return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();
                });
            }

            function capitalizeFirstLetter(text) {
                if (text.length === 0) return text;
                return text.charAt(0).toUpperCase() + text.slice(1).toLowerCase();
            }

            const inputFields = [
                "diagnosisText-@item.ConsultationTbls.Consultation_ID",
                "TreatmentType-@item.ConsultationTbls.Consultation_ID",
                "medicine-@item.ConsultationTbls.Consultation_ID"
            ];

            inputFields.forEach(function (fieldId) {
                const field = document.getElementById(fieldId);
                if (field) {
                    field.addEventListener("blur", function () {
                        this.value = toTitleCase(this.value);
                    });
                }
            });

            const notesField = document.getElementById("notes-@item.ConsultationTbls.Consultation_ID");
            if (notesField) {
                notesField.addEventListener("blur", function () {
                    this.value = capitalizeFirstLetter(this.value);
                });
            }

            const dosageField = document.getElementById("dosage-@item.ConsultationTbls.Consultation_ID");
            if (dosageField) {
                dosageField.addEventListener("blur", function () {
                    this.value = capitalizeFirstLetter(this.value);
                });
            }

            const frequencyField = document.getElementById("frequency-@item.ConsultationTbls.Consultation_ID");
            if (frequencyField) {
                frequencyField.addEventListener("blur", function () {
                    this.value = capitalizeFirstLetter(this.value);
                });
            }

            const instructionsField = document.getElementById("instructions-@item.ConsultationTbls.Consultation_ID");
            if (instructionsField) {
                instructionsField.addEventListener("blur", function () {
                    this.value = capitalizeFirstLetter(this.value);
                });
            }
        });
    </script>

    <div class="modal fade" id="treatmentForm-@item.ConsultationTbls.Consultation_ID" tabindex="-1" role="dialog" aria-labelledby="addDiagnosisModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addDiagnosisModalLabel">Add Treament</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="treamentform-@item.ConsultationTbls.Consultation_ID">
                        <input type="hidden" name="Consultation_ID" class="form-control" id="treatment-@item.ConsultationTbls.Consultation_ID">
                        <div class="mb-3">
                            <label for="treatmentName" class="form-label">Treatment Name</label>
                            <input type="text" name="TreatmentType" class="form-control" id="TreatmentType-@item.ConsultationTbls.Consultation_ID" placeholder="Enter treatment name" required>
                            <div class="invalid-feedback">Please enter a treatment name.</div>
                        </div>
                        <div class="mb-3">
                            <label for="notes" class="form-label">Notes</label>
                            <textarea class="form-control" name="Notes" id="notes-@item.ConsultationTbls.Consultation_ID" rows="3" placeholder="Enter treatment notes"></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="followUpDate" class="form-label">Follow-up Date</label>
                            <input type="date" name="FollowUpCheckUp" class="form-control" id="followUpDate-@item.ConsultationTbls.Consultation_ID" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer text-right">
                    <button data-dismiss="modal" type="button" class="btn btn-rounded btn-danger btn-outline mr-1">
                        <i class="mdi mdi-close"></i> Close
                    </button>
                    <button id="treatmentSavebtn-@item.ConsultationTbls.Consultation_ID" type="button" class="text-right btn btn-rounded btn-primary btn-outline">
                        <i class="ti-save-alt"></i> Save
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Get today's date in YYYY-MM-DD format
        var today = new Date().toISOString().split('T')[0];

        // Set the min attribute of the input field to today
        document.getElementById("followUpDate-@item.ConsultationTbls.Consultation_ID").setAttribute("min", =today);
    </script>



<script src="~/js/helper.js"></script>
<script>
$(document).ready(function () {
    // Handle the modal show event to populate the ID field
    $('#addDiagnosisModal-@item.ConsultationTbls.Consultation_ID').on('show.bs.modal', function (event) {
        var button = $(event.relatedTarget); // Button that triggered the modal
        var consultationId = button.data('consultation-id'); // Extract info from data-* attributes
        var modal = $(this);
        modal.find('.modal-body #diagnosis').val(consultationId); // Populate the ID field in the modal
    });

    // Handle the save button click event
    $('#saveDiagnosis-@item.ConsultationTbls.Consultation_ID').click(function (e) {
        debugger
        e.preventDefault();
        SavingFunction({
            url: "@Url.Action("UpdateDiagnosis", "Patient")",
            form: "#diagnosisForm-@item.ConsultationTbls.Consultation_ID",
            title: "Are you sure",
            message: "Do you want to save this record",
                    callback: function (response) {
                        console.log('Callback executed with response:', response);

                        if (response.success) {
                            // Update the <h2> element with the new diagnosis text
                            $('#diagnosis-heading-@item.ConsultationTbls.Consultation_ID').html('<strong>' + response.newDiagnosis + '</strong>');
                            $('#addDiagnosisModal-@item.ConsultationTbls.Consultation_ID').modal('hide');

                        } else {
                            console.error('Error:', response.message);
                            alert(response.message); // Optionally show error message to the user
                        }
                    }
        });
    });
});
</script>
    <script>
        $(document).ready(function () {
            // Handle the modal show event to populate the ID field
            
            $('#treatmentForm-@item.ConsultationTbls.Consultation_ID').on('show.bs.modal', function (event) {
                var button = $(event.relatedTarget); // Button that triggered the modal
                var consultationId = button.data('consultation-id'); // Extract info from data-* attributes
                var modal = $(this);
                modal.find('.modal-body #treatment-@item.ConsultationTbls.Consultation_ID').val(consultationId); // Populate the ID field in the modal
            });
            debugger

            // Handle the save button click event
            $('#treatmentSavebtn-@item.ConsultationTbls.Consultation_ID').click(function (e) {
                e.preventDefault();

                // Call the SavingFunction with necessary parameters
                SavingFunction({
                    title: "Are you sure",
                    message: "Do you want to save this record?",
                    url: "@Url.Action("AddTreatment", "Patient")",
                    form: "#treamentform-@item.ConsultationTbls.Consultation_ID",
                    callback: function (response) {
                        console.log(response); // Log response to verify

                        $('#noTreatmentRecord').hide();
                        $('#treatmentForm-@item.ConsultationTbls.Consultation_ID').modal('hide');
                        // Callback function to handle success
                        if (response.success) {
                            var newTreatmentHtml = `
                                    <div class="col-lg-12 mb-4">
                                        <div class="card border-primary position-relative">
                                            <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                                                <span>Treatment Details</span>
                                                <div class="d-flex justify-content-between align-items-center mb-3">
                                                    <h4 class="text-primary">Treatment</h4>
                                                </div>
                                            </div>
                                            <div class="card-body">
                                                <div class="mb-3">
                                                    <h5 class="card-title">Treatment Name</h5>
                                                    <p class="card-text text-muted">` + response.treatmentType + `</p>
                                                </div>
                                                <div class="mb-3">
                                                    <h5 class="card-title">Notes</h5>
                                                    <p class="card-text text-muted">` + response.notes + `</p>
                                                </div>
                                                <div class="mb-3">
                                                    ` + (response.followUpCheckUp ? `
                                                        <h5 class="card-title">Follow-up Check</h5>
                                                        <p class="card-text text-muted">` + response.followUpCheckUp + `</p>
                                                    ` : `
                                                        <h5 class="card-title">Remarks</h5>
                                                        <p class="card-text text-muted">Ok</p>
                                                    `) + `
                                                </div>
                                            </div>
                                            <div class="card-footer text-end">
                                                <button type="button" class="btn btn-primary btn-rounded" data-toggle="modal"
                                                        data-target="#ViewPrescription-` + response.consultationId + `"
                                                        data-treatment-id="` + response.treatmentId + `"
                                                        onclick="setTreatmentId(this)">
                                                    <i class="mdi mdi-eye"></i> Prescription
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                `;

                            // Append the new treatment HTML to the container
                            $('.treatment-container').append(newTreatmentHtml);
                        } else {
                            console.error('Error:', response.message);
                            alert(response.message); // Optionally show error message to the user
                        }
                    }
                });
            });
        });
    </script>


    <!----------walang callback sa add treament  to------------>
@*     <script>

        $(document).ready(function () {
            // Handle the modal show event to populate the ID field
            $('#treatmentForm-@item.ConsultationTbls.Consultation_ID').on('show.bs.modal', function (event) {
                var button = $(event.relatedTarget); // Button that triggered the modal
                var consultationId = button.data('consultation-id'); // Extract info from data-* attributes
                var modal = $(this);
                modal.find('.modal-body #treatment').val(consultationId); // Populate the ID field in the modal
            });

            // Handle the save button click event
            $('#treatmentSavebtn-@item.ConsultationTbls.Consultation_ID').click(function (e) {
                e.preventDefault();
                SavingFunction({
                    url: "@Url.Action("AddTreatment", "Patient")",
                    form: "#treamentform-@item.ConsultationTbls.Consultation_ID",
                    title: "Are you sure",
                    message: "Do you want to save this record",
                    redirection: "@Url.Action("ViewRecord", "Patient", new { id = Model.OwnerTbls.Owner_ID })"
                });
            });
        });
    </script> *@

@*     <script>
        $(document).ready(function () {
            // When the 2nd modal is shown, hide the 1st modal
            $('#MedicalInfo-@item.ConsultationTbls.Consultation_ID').on('show.bs.modal', function () {
                $('#ShowDetail-@Model.PatientTbls.Patient_ID').modal('hide');
            });

            // When the 2nd modal is hidden, show the 1st modal only if the 3rd modal is not shown
            $('#MedicalInfo-@item.ConsultationTbls.Consultation_ID').on('hidden.bs.modal', function () {
                if (!$('.modal.show').length) { // Check if any modal is currently shown
                    $('#ShowDetail-@Model.PatientTbls.Patient_ID').modal('show');
                }
            });

            // // When the 3rd modal is shown, hide the 2nd modal
            // $('#ViewPrescription-@item.ConsultationTbls.Consultation_ID').on('show.bs.modal', function () {
            //     $('#MedicalInfo-@item.ConsultationTbls.Consultation_ID').modal('hide');
            // });

            // // When the 3rd modal is hidden, show the 2nd modal only if no other modal is shown
            // $('#ViewPrescription-@item.ConsultationTbls.Consultation_ID').on('hidden.bs.modal', function () {
            //     if (!$('.modal.show').length) { // Check if any modal is currently shown
            //         $('#MedicalInfo-@item.ConsultationTbls.Consultation_ID').modal('show');
            //     }
            // });


            $('#AddPrescription-@item.ConsultationTbls.Consultation_ID').on('show.bs.modal', function () {
                $('#ViewPrescription-@item.ConsultationTbls.Consultation_ID').modal('hide');
            });

            // When the 3rd modal is hidden, show the 2nd modal only if no other modal is shown
            $('#AddPrescription-@item.ConsultationTbls.Consultation_ID').on('hidden.bs.modal', function () {
                if (!$('.modal.show').length) { // Check if any modal is currently shown
                    $('#ViewPrescription-@item.ConsultationTbls.Consultation_ID').modal('show');
                }
            });

        });
    </script> *@
}

<!-- Modal Structure -->



   

@* <div class="modal fade viewlab show" tabindex="-1" role="dialog" aria-labelledby="result-popup" style="display: block; padding-right: 17px;" id="result" aria-modal="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="result-popup">Radiology Investigations - Result</h4>
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
            </div>
            <div class="modal-body">
                <div class="row justify-content-between">
                    <div class="col-md-7 col-12">
                        <h4>Test Name - CBC/Blood Chemistry</h4>
                    </div>
                    <div class="col-md-5 col-12">
                        <h4 class="text-right">Patient ID : L0000002821</h4>
                    </div>
                </div>
                <div class="table-responsive">
                    <table class="table table-bordered">
                        <thead class="bg-secondary">
                            <tr>
                                <th scope="col">Date of Test</th>
                                <th scope="col">WBC (x10^3/µL)</th>
                                <th scope="col">RBC (x10^6/µL)</th>
                                <th scope="col">Hemoglobin (g/dL)</th>
                                <th scope="col">Hematocrit (%)</th>
                                <th scope="col">MCV (fL)</th>
                                <th scope="col">MCH (pg)</th>
                                <th scope="col">MCHC (g/dL)</th>
                                <th scope="col">Platelet Count (x10^3/µL)</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>2024-08-10</td>
                                <td>7.5</td>
                                <td>5.2</td>
                                <td>15.8</td>
                                <td>48.0</td>
                                <td>92.3</td>
                                <td>30.4</td>
                                <td>33.0</td>
                                <td>320</td>
                            </tr>
    
                        </tbody>
                    </table>
                </div>
                <div class="comment">
                    <p><span class="font-weight-600">Comment</span> : <span class="comment-here text-mute">Lorem ipsum dolor sit amet, consectetur adipisicing elit. </span></p>
                </div>
                <div class="table-responsive">
                    <table class="table">
                        <tbody>
                            <tr>
                                <th colspan="2" class="b-0">Test By</th>
                                <th colspan="2" class="b-0">Signed By</th>
                            </tr>
                            <tr class="bg-secondary">
                                <td>Donald jr</td>
                                <td>Time : 11-8-2017   04:22</td>
                                <td>Lous Clark</td>
                                <td>Time : 11-8-2017   04:22</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-danger pull-right" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-info pull-right">Print</button>
                <button type="button" class="btn btn-success pull-right">Save</button>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div> *@